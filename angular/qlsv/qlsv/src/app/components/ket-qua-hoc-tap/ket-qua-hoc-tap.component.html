<div class="diem-container" *ngIf="bangDiem.length > 0">
  <h3>Kết quả học tập</h3>
  <table class="diem-table">
    <thead>
      <tr>
        <th>Môn học</th>
        <th>Điểm quá trình</th>
        <th>Điểm thành phần</th>
        <th>Tổng kết</th>
        <th>Hành động</th> </tr>
    </thead>
    <tbody>
      <tr *ngFor="let diem of bangDiem">
        <td>{{ diem.monHocTen }}</td>
        <td class="text-center">{{ diem.diem_qua_trinh }}</td>
        <td class="text-center">{{ diem.diem_thanh_phan }}</td>
        <td class="text-center bold">
          {{ (diem.diem_qua_trinh + diem.diem_thanh_phan) / 2 }}
        </td>
        <td class="text-center">
          <button (click)="openEditForm(diem)" >Sửa điểm</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div class="modal-backdrop" *ngIf="isEditing">
  <div class="modal-content">

    <div class="modal-header">
      <h4>Nhập điểm: {{ tenMonDangSua }}</h4>
      <span class="close-btn" (click)="closeEditForm()">&times;</span>
    </div>

    <form #editForm="ngForm">

      <div class="modal-body">

        <div class="form-group">
          <label>Điểm quá trình <span class="text-danger">*</span>:</label>
          <input type="number"
                 class="form-control"
                 placeholder="Nhập 0-10"
                 name="diemQuaTrinh"
                 [(ngModel)]="editingData.diemQuaTrinh"
                 required
                 min="0"
                 max="10"
                 #dqt="ngModel"
                 [class.is-invalid]="dqt.invalid && (dqt.dirty || dqt.touched)">

          <div *ngIf="dqt.invalid && (dqt.dirty || dqt.touched)" class="text-danger small mt-1">
            <div *ngIf="dqt.errors?.['required']">Vui lòng nhập điểm quá trình.</div>
            <div *ngIf="dqt.errors?.['min'] || dqt.errors?.['max']">Điểm phải từ 0 đến 10.</div>
          </div>
        </div>

        <div class="form-group mt-3"> <label>Điểm thành phần <span class="text-danger">*</span>:</label>
          <input type="number"
                 class="form-control"
                 placeholder="Nhập 0-10"
                 name="diemThanhPhan"
                 [(ngModel)]="editingData.diemThanhPhan"
                 required
                 min="0"
                 max="10"
                 #dtp="ngModel"
                 [class.is-invalid]="dtp.invalid && (dtp.dirty || dtp.touched)">

          <div *ngIf="dtp.invalid && (dtp.dirty || dtp.touched)" class="text-danger small mt-1">
            <div *ngIf="dtp.errors?.['required']">Vui lòng nhập điểm thành phần.</div>
            <div *ngIf="dtp.errors?.['min'] || dtp.errors?.['max']">Điểm phải từ 0 đến 10.</div>
          </div>
        </div>

      </div>

      <div class="modal-footer">
        <button type="button" (click)="closeEditForm()" class="btn-cancel">Hủy bỏ</button>

        <button type="button"
                (click)="saveDiem()"
                class="btn-save"
                [disabled]="editForm.invalid"
                [style.opacity]="editForm.invalid ? '0.5' : '1'">
          Lưu điểm
        </button>
      </div>

    </form>
  </div>
</div>




